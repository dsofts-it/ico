{
  "info": {
    "_postman_id": "c6c5ce76-8f4b-4d5b-9c7a-ico-backend-flow",
    "name": "ICO Backend Full Flow",
    "description": "Covers mobile signup/login with PIN, wallet (topup, referral, withdraw), token buy/sell, and referral checks.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:5000" },
    { "key": "mobile", "value": "9999999999" },
    { "key": "name", "value": "Test User" },
    { "key": "referralCode", "value": "REFCODE" },
    { "key": "otp", "value": "123456" },
    { "key": "pin", "value": "1234" },
    { "key": "userId", "value": "" },
    { "key": "token", "value": "" },
    { "key": "topupAmount", "value": "500" },
    { "key": "withdrawAmount", "value": "200" },
    { "key": "redeemAmount", "value": "100" },
    { "key": "tokenAmount", "value": "10" },
    { "key": "sellTokenAmount", "value": "5" },
    { "key": "redirectUrl", "value": "https://httpbin.org/post" }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Signup - Mobile Init (requires referral)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/signup/mobile-init", "host": ["{{baseUrl}}"], "path": ["api", "auth", "signup", "mobile-init"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{name}}\",\n  \"mobile\": \"{{mobile}}\",\n  \"referralCode\": \"{{referralCode}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.userId) { pm.environment.set('userId', res.userId); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Signup - Verify OTP + Set PIN",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/signup/verify", "host": ["{{baseUrl}}"], "path": ["api", "auth", "signup", "verify"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{userId}}\",\n  \"otp\": \"{{otp}}\",\n  \"type\": \"mobile\",\n  \"pin\": \"{{pin}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.token) { pm.environment.set('token', res.token); }",
                  "if (res._id) { pm.environment.set('userId', res._id); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Login Mobile - Send OTP",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/login/mobile", "host": ["{{baseUrl}}"], "path": ["api", "auth", "login", "mobile"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobile\": \"{{mobile}}\"\n}"
            }
          }
        },
        {
          "name": "Login Mobile - Verify OTP",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/login/mobile", "host": ["{{baseUrl}}"], "path": ["api", "auth", "login", "mobile"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobile\": \"{{mobile}}\",\n  \"otp\": \"{{otp}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.token) { pm.environment.set('token', res.token); }",
                  "if (res._id) { pm.environment.set('userId', res._id); }"
                ]
              }
            }
          ]
        },
        {
          "name": "Login Mobile - PIN",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/login/mobile", "host": ["{{baseUrl}}"], "path": ["api", "auth", "login", "mobile"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"mobile\": \"{{mobile}}\",\n  \"pin\": \"{{pin}}\"\n}"
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.token) { pm.environment.set('token', res.token); }",
                  "if (res._id) { pm.environment.set('userId', res._id); }"
                ]
              }
            }
          ]
        },
        {
          "name": "PIN Setup / Update",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/auth/pin/setup", "host": ["{{baseUrl}}"], "path": ["api", "auth", "pin", "setup"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pin\": \"{{pin}}\"\n}"
            }
          },
          "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] }
        }
      ]
    },
    {
      "name": "Wallet",
      "item": [
        {
          "name": "Wallet Summary",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/wallet/summary", "host": ["{{baseUrl}}"], "path": ["api", "wallet", "summary"] }
          }
        },
        {
          "name": "Wallet Topup (PhonePe)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/wallet/topup", "host": ["{{baseUrl}}"], "path": ["api", "wallet", "topup"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": {{topupAmount}},\n  \"redirectUrl\": \"{{redirectUrl}}\"\n}"
            }
          }
        },
        {
          "name": "Wallet Transactions",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/wallet/transactions", "host": ["{{baseUrl}}"], "path": ["api", "wallet", "transactions"] }
          }
        },
        {
          "name": "Wallet Withdraw",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/wallet/withdraw", "host": ["{{baseUrl}}"], "path": ["api", "wallet", "withdraw"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": {{withdrawAmount}},\n  \"note\": \"Test withdraw\"\n}"
            }
          }
        },
        {
          "name": "Redeem Referral to Wallet",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/wallet/referral/redeem", "host": ["{{baseUrl}}"], "path": ["api", "wallet", "referral", "redeem"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": {{redeemAmount}}\n}"
            }
          }
        }
      ],
      "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] }
    },
    {
      "name": "Token (ICO)",
      "item": [
        {
          "name": "Token Price (public)",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/ico/price", "host": ["{{baseUrl}}"], "path": ["api", "ico", "price"] }
          },
          "auth": null
        },
        {
          "name": "Token Summary",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/ico/summary", "host": ["{{baseUrl}}"], "path": ["api", "ico", "summary"] }
          }
        },
        {
          "name": "Token Transactions",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/ico/transactions", "host": ["{{baseUrl}}"], "path": ["api", "ico", "transactions"] }
          }
        },
        {
          "name": "Buy Token (Wallet)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/ico/buy", "host": ["{{baseUrl}}"], "path": ["api", "ico", "buy"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tokenAmount\": {{tokenAmount}},\n  \"useWallet\": true\n}"
            }
          }
        },
        {
          "name": "Buy Token (PhonePe)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/ico/buy", "host": ["{{baseUrl}}"], "path": ["api", "ico", "buy"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tokenAmount\": {{tokenAmount}},\n  \"useWallet\": false\n}"
            }
          }
        },
        {
          "name": "Sell Token (manual payout)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "url": { "raw": "{{baseUrl}}/api/ico/sell", "host": ["{{baseUrl}}"], "path": ["api", "ico", "sell"] },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"tokenAmount\": {{sellTokenAmount}}\n}"
            }
          }
        }
      ],
      "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] }
    },
    {
      "name": "Referral",
      "item": [
        {
          "name": "Referral Summary",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/user/referral/summary", "host": ["{{baseUrl}}"], "path": ["api", "user", "referral", "summary"] }
          }
        },
        {
          "name": "Referral Earnings",
          "request": {
            "method": "GET",
            "url": { "raw": "{{baseUrl}}/api/user/referral/earnings", "host": ["{{baseUrl}}"], "path": ["api", "user", "referral", "earnings"] }
          }
        }
      ],
      "auth": { "type": "bearer", "bearer": [{ "key": "token", "value": "{{token}}", "type": "string" }] }
    }
  ]
}
